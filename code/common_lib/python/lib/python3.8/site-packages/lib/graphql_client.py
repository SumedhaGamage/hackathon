import requests
import os


class GraphqlClient:
    def __init__(self):
        self.host = os.environ.get('APPSYNC_API_ENDPOINT_URL')
        self.api_key = os.environ.get('GRAPHQL_API_KEY')

    def call_appointment_update_mutation(self, slot_update):
        session = requests.Session()
        mutation = """
        mutation appointmentUpdate($input: AppointmentInput! ) {
            getAppointmentBooking(input: $input) {
                date
                day
                dispensary_id
                doctor_id
                slot {
                    patient {
                        address
                        age
                        booking_at
                        booking_method
                        check_in_at
                        check_out_at
                        date_of_birth
                        display_name
                        family_member
                        first_name
                        gender
                        id
                        last_name
                        middle_name
                        mobile_no
                        profile_photo_url
                        symptom
                    }
                    previous_visits {
                        date
                        doctor {
                            display_name
                        }
                        note
                        visit_number
                    }
                    slot_id
                    slot_time
                    status
                    symptom
                    note
                    kiosk
                    booking_method
                    vital_signs {
                        weight 
                        height
                        high_pressure
                        low_pressure
                        body_temp
                    }
                }
            }
        }
        """
        response = session.request(
            url=self.host,
            method='POST',
            json={
                'query': mutation,
                'variables': {
                    'input': slot_update
                }
            },
            headers={
                'x-api-key': self.api_key
            }
        )
        print(response.__dict__)
